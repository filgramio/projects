<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>All the rules</title>
</head>
  <body>
	<!--This draws the canvas on the webpage -->
    <canvas id="mycanvas"></canvas> 
  </body>
 
  <!-- Include the processing.js library -->
  <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
  <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
  <script>
  var programCode = function(processingInstance) {
    with (processingInstance) {
      size(window.innerWidth-15, window.innerHeight-20); 
      frameRate(30);
        
      // Paste code from Khan Academy here:

      var keys = [];
      keyPressed = function() {
        keys[keyCode] = true;
      };
      keyReleased = function() {
        keys[keyCode] = false;
      };

      var onImg = loadImage("images/on_tile.png");
      var offImg = loadImage("images/off_tile.png");
      var mark = loadImage("images/mark.png");

      var Tile = function(type,image,okCheck){
        this.type = type;
        this.image = loadImage(image) || null;
        this.okCheck = okCheck || function(onOff){ return true; };
      };

      var currentLevel = null;

      var blank = new Tile("blank","images/blank.png",function(x,y){ return true; });
      var square = new Tile("square","images/square.png",function(x,y){ return currentLevel.onOffGrid[y][x] == 1;});
      var plus = new Tile("plus","images/plus.png",function(x,y){ 
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) == 1){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] != 1){
                  return false;
                }
              }
            }
          }
        }
        return true;
      });
      var none = new Tile("none","images/none.png",function(x,y){ return currentLevel.onOffGrid[y][x] == 0; });
      var one = new Tile("one","images/one.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == 1){
                  count++;
                }
              }
            }
          }
        }
        return count == 1;
      });
      var two = new Tile("two","images/two.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == 1){
                  count++;
                }
              }
            }
          }
        }
        return count == 2;
      });
      var three = new Tile("three","images/three.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == 1){
                  count++;
                }
              }
            }
          }
        }
        return count == 3;
      });
      var four = new Tile("four","images/four.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == 1){
                  count++;
                }
              }
            }
          }
        }
        return count == 4;
      });
      var five = new Tile("five","images/five.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == 1){
                  count++;
                }
              }
            }
          }
        }
        return count == 5;
      });
      var six = new Tile("six","images/six.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == 1){
                  count++;
                }
              }
            }
          }
        }
        return count == 6;
      });
      var one_dot = new Tile("one_dot","images/one_dot.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 1;
      });
      var two_dot = new Tile("two_dot","images/two_dot.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 2;
      });
      var three_dot = new Tile("three_dot","images/three_dot.png",function(x,y){         
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 3;
      });
      var four_dot = new Tile("four_dot","images/four_dot.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 4;
      });
      var five_dot = new Tile("five_dot","images/five_dot.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 5;
      });      
      var six_dot = new Tile("six_dot","images/six_dot.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 6;
      });
      var seven_dot = new Tile("seven_dot","images/seven_dot.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 7;
      });
      var eight_dot = new Tile("eight_dot","images/eight_dot.png",function(x,y){ 
        var count = 0;
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) != 0){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == currentLevel.onOffGrid[y][x]){
                  count++;
                }
              }
            }
          }
        }
        return count == 8;
      });
      var plus_zero = new Tile("plus_zero","images/plus_zero.png",function(x,y){ 
        for(var i = -1; i<=1; i++){
          for(var j = -1; j<=1; j++){
            if(abs(i)+abs(j) == 1){
              var checkX = x+i;
              var checkY = y+j;
              if(checkX >= 0 && checkX < currentLevel.cols && checkY >= 0 && checkY < currentLevel.rows){
                if(currentLevel.onOffGrid[checkY][checkX] == 1){
                  return false;
                }
              }
            }
          }
        }
        return true;
      });



      var scene = "game";

      var Level = function(levelNumber,grid,encodeArray,cellSize){
        this.levelNumber = levelNumber || 1;
        this.grid = grid;
        this.rows = grid.length;
        this.cols = grid[0].length;
        this.cellSize = cellSize || 40;
        this.width = this.cols * this.cellSize;
        this.height = this.rows * this.cellSize;
        this.encodeArray = encodeArray;
        this.onOffGrid = [];
        for(var r=0; r<this.rows; r++){
          this.onOffGrid[r] = [];
          for(var c=0; c<this.cols; c++){
            this.onOffGrid[r][c] = 0;
          }
        }
        this.markGrid = [];
        for(var r=0; r<this.rows; r++){
          this.markGrid[r] = [];
          for(var c=0; c<this.cols; c++){
            this.markGrid[r][c] = 0;
          }
        }
      };      

      var level1 = new Level(1,
        [
        [0,0,1,0,0],
        [1,0,0,0,0],
        [0,1,0,0,1]],
        [blank,square]
      );

      var level2 = new Level(1,
        [
        [0,1,1,0,0],
        [1,1,0,1,0],
        [1,1,0,0,0]],
        [blank,square]
      );

      var level3 = new Level(1,
        [
        [0,1,0,0,0],
        [0,0,0,1,0],
        [0,2,0,0,0],
        [0,0,0,0,0]],
        [blank,square,plus]
      );

      var level4 = new Level(1,
        [
        [0,0,0,1,0],
        [0,0,0,0,0],
        [0,2,2,0,0],
        [0,0,0,0,0]],
        [blank,square,plus]
      );

      var level5 = new Level(1,
        [
        [0,0,0],
        [0,0,0],
        [3,0,0]],
        [blank,square,plus,three]
      );

      var level6 = new Level(1,
        [
        [0,0,0],
        [0,0,0],
        [2,1,0]],
        [blank,none,two,three]
      );

      var level7 = new Level(1,
        [
        [0,5,0],
        [0,0,0],
        [2,0,3],
        [0,0,0]],
        [blank,none,two,three,four,five]
      );

      var level8 = new Level(1,
        [
        [2,0,0,0],
        [1,0,5,0],
        [0,0,6,0],
        [0,0,0,0]],
        [blank,one,square,none,four,five,six]
      );

      var level9 = new Level(1,
        [
        [0,0,0,0],
        [0,2,0,0],
        [0,0,6,0],
        [0,0,0,0]],
        [blank,none,plus_zero,three_dot,four_dot,five_dot,six]
      );

      var level10 = new Level(1,
        [
        [0,0,0,0,0],
        [0,0,0,0,0],
        [2,1,3,4,0]],
        [blank,plus,plus_zero,three_dot,none,five_dot,six]
      );

      var level11 = new Level(1,
        [
        [0,0,0,0,0],
        [0,0,0,0,0],
        [1,2,3,4,0]],
        [blank,plus,plus_zero,three_dot,square,five_dot,six]
      );

      var level12 = new Level(1,
        [
        [0,0,7],
        [1,0,5],
        [2,0,0]],
        [blank,one,two_dot,three_dot,four_dot,five_dot,six_dot,none,eight_dot]
      );


      var levels = [level1,level2,level3,level4,level5,level6,level7,level8,level9,level10,level11,level12];
      var currentLevelNumber = 1;
      var currentLevel = levels[currentLevelNumber-1];

      var tileX = 0;
      var tileY = 0;
      var isInGrid = function(){
        return (tileX >= 0 && tileX < currentLevel.cols && tileY >= 0 && tileY < currentLevel.rows);
      };

      var drawMap = function(level){
        pushMatrix();
        translate(floor(width/2), floor(height/2));
        translate(floor(-level.width/2), floor(-level.height/2));
        for(var r=0; r<level.rows; r++){
          for(var c=0; c<level.cols; c++){
            var cell = level.encodeArray[level.grid[r][c]];
            var x = c * level.cellSize;
            var y = r * level.cellSize;
            image(cell.image,x,y,level.cellSize,level.cellSize);
            /*if(level.onOffGrid[r][c] == 0){
              image(offImg,x,y,level.cellSize,level.cellSize);
            }*/
            if(level.onOffGrid[r][c] == 1){
              image(onImg,x,y,level.cellSize,level.cellSize);
            }
            if(level.markGrid[r][c] == 1){
              image(mark,x,y,level.cellSize,level.cellSize);
            }
          }
        }
        popMatrix();
      };

      var mouseClicked = function(){
        switch(scene){
          case "game":
            if(isInGrid() && mouseButton == LEFT){
              if(currentLevel.onOffGrid[tileY][tileX] == 0){
                currentLevel.onOffGrid[tileY][tileX] = 1;
                currentLevel.markGrid[tileY][tileX] = 0;
              } else {
                currentLevel.onOffGrid[tileY][tileX] = 0;
              }              
            }
            if(isInGrid() && mouseButton == RIGHT){
              if(currentLevel.markGrid[tileY][tileX] == 0){
                currentLevel.markGrid[tileY][tileX] = 1;
              } else {
                currentLevel.markGrid[tileY][tileX] = 0;
              }              
            }
          break;
        }
      };

      var checkForWin = function(){
        for(var r=0; r<currentLevel.rows; r++){
          for(var c=0; c<currentLevel.cols; c++){
            var cell = currentLevel.encodeArray[currentLevel.grid[r][c]];
            if(!cell.okCheck(c,r)){
              return false;
            }
          }
        }
        return true;
      };

      var nextLevel = function(){
        currentLevelNumber++;
        currentLevel = levels[(currentLevelNumber-1) % levels.length];
        for(var r=0; r<currentLevel.rows; r++){
          currentLevel.onOffGrid[r] = [];
          for(var c=0; c<currentLevel.cols; c++){
            currentLevel.onOffGrid[r][c] = 0;
          }
        }
      };

      var resetLevel = function(){
        for(var r=0; r<currentLevel.rows; r++){
          currentLevel.onOffGrid[r] = [];
          for(var c=0; c<currentLevel.cols; c++){
            currentLevel.onOffGrid[r][c] = 0;
          }
        }
      };

      draw = function(){
        background(230);

        if(scene == "game"){
          
          //setup
          tileX = floor((mouseX - (floor(width/2) - floor(currentLevel.width/2))) / currentLevel.cellSize);
          tileY = floor((mouseY - (floor(height/2) - floor(currentLevel.height/2))) / currentLevel.cellSize);
          
          drawMap(currentLevel);

          //check for win
          if(keys[32] && checkForWin()){
            nextLevel();
          }

          //reset level
          if(keys[82]){
            resetLevel();
          }

        }
      };

    }};

  // Get the canvas that ProcessingJS will use
  var canvas = document.getElementById("mycanvas"); 
  // Pass the function to ProcessingJS constructor
  var processingInstance = new Processing(canvas, programCode); 
  </script>
</html>