<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Minimal Web Page</title>
</head>
  <body>
	<!--This draws the canvas on the webpage -->
    <canvas id="mycanvas"></canvas> 
  </body>
 
  <!-- Include the processing.js library -->
  <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
  <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
  <script>
  var programCode = function(processingInstance) {
    with (processingInstance) {
      size(window.innerWidth-15, window.innerHeight-15); 
      frameRate(30);
        
      // Paste code from Khan Academy here:

      var keys = [];

      keyPressed = function(){
        keys[keyCode] = true;
      }

      keyReleased = function(){
        keys[keyCode] = false;
      }

      var Level = function(config) {
        this.dimensions = config.dimensions;
        this.start = config.start;
      };

      var level1 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,2,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [3,14]
      });

      var type = 0;
      var currentDimension = 0;
      var currentLevel = level1;

      var playerX = currentLevel.start[0];
      var playerY = currentLevel.start[1];

      var moveCooldown = 3;

      draw = function() {
        background(250);
        //println("Drawing...");

        //draw the player

        noStroke();
        fill(255,0,0);
        rect(playerX*40,playerY*40,40,40,5);

        //move the player
        if(moveCooldown < 0){
          if(keys[UP] && currentLevel.dimensions[currentDimension][playerY-1][playerX] !== 1){
            playerY -= 1;
            moveCooldown = 3;
          }
          if(keys[DOWN] && currentLevel.dimensions[currentDimension][playerY+1][playerX] !== 1){
            playerY += 1;
            moveCooldown = 3;
          }
          if(keys[LEFT] && currentLevel.dimensions[currentDimension][playerY][playerX-1] !== 1){
            playerX -= 1;
            moveCooldown = 3;
          }
          if(keys[RIGHT] && currentLevel.dimensions[currentDimension][playerY][playerX+1] !== 1){
            playerX += 1;
            moveCooldown = 3;
          }
        }
        moveCooldown -= 1;

        //draw the level
        for (var i = 0; i < 18; i++) {
          for (var j = 0; j < 10; j++) {
            if (currentLevel.dimensions[currentDimension][i][j] === 1) {

              type = 0;

              if(currentLevel.dimensions[currentDimension][max(i-1,0)][j] === 1){
                type += 1;
              }
              if(currentLevel.dimensions[currentDimension][i][min(j+1,currentLevel.dimensions[currentDimension][i].length)] === 1){
                type += 2;
              }
              if(currentLevel.dimensions[currentDimension][min(i+1,currentLevel.dimensions[currentDimension].length-1)][j] === 1){
                type += 4;
              }
              if(currentLevel.dimensions[currentDimension][i][max(j-1,0)] === 1){
                type += 8;
              }


              pushMatrix();
              translate(j*40, i*40);
              noStroke();
              switch(type){
                case 0:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                break;
                case 1:
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  triangle(20,0,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  triangle(0,0,20,0,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(8, 0, 24, 24);
                break;
                case 2:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  triangle(40,20,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  triangle(40,40,40,20,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(16, 8, 24, 24);
                break;
                case 3:
                  fill(240);
                  triangle(40,40,0,40,40,0);
                  fill(220);
                  triangle(0,0,0,40,40,0);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(16, 0, 24, 32);
                  rect(8, 0, 24, 24);
                break;
                case 4:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  triangle(40,40,20,40,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  triangle(20,40,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(8, 16, 24, 24);
                break;
                case 5:
                  fill(160);
                  rect(20,0,20,40);
                  fill(220);
                  rect(0,0,20,40);
                  fill(200);
                  rect(8, 0, 24, 40);
                break;
                case 6:
                  fill(140);
                  triangle(0,0,40,0,40,40);
                  fill(220);
                  triangle(0,0,0,40,40,40);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(8, 16, 32, 24);
                  rect(16, 8, 24, 24);
                break;
                case 7:
                  fill(220);
                  rect(0,0,20,40);
                  fill(200);
                  rect(8, 0, 32, 40);
                break;
                case 8:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  triangle(0,0,0,20,20,20);
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  triangle(0,20,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(0, 8, 24, 24);
                break
                case 9:
                  fill(160);
                  triangle(40,40,40,0,0,0);
                  fill(240);
                  triangle(40,40,0,40,0,0);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(0, 0, 32, 24);
                  rect(0, 0, 24, 32);
                break
                ;
                case 10:
                  fill(140);
                  rect(0,0,40,20);
                  fill(240);
                  rect(0,20,40,20);
                  fill(200);
                  rect(0, 8, 40, 24);
                break;
                case 11:
                  fill(240);
                  rect(0,20,40,20);
                  fill(200);
                  rect(0, 0, 40, 32);
                break;
                case 12:
                  fill(140);
                  triangle(0,0,40,0,0,40);
                  fill(160);
                  triangle(40,40,40,0,0,40);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(0, 8, 24, 32);
                  rect(8, 16, 24, 24);
                break;
                case 13:
                  fill(160);
                  rect(20,0,20,40);
                  fill(200);
                  rect(0, 0, 32, 40);
                break;
                case 14:
                  fill(140);
                  rect(0,0,40,20);
                  fill(200);
                  rect(0, 8, 40, 32);
                break;
                case 15:
                  fill(200);
                  rect(0, 0, 40, 40);
                break; 
              }

              popMatrix();
            }else if (currentLevel.dimensions[currentDimension][i][j] === 2){
              fill(50,230,50);
              rect(40*j,40*i,40,40,5);
            }
          }
        }
      }
    }};

  // Get the canvas that ProcessingJS will use
  var canvas = document.getElementById("mycanvas"); 
  // Pass the function to ProcessingJS constructor
  var processingInstance = new Processing(canvas, programCode); 
  </script>
</html>