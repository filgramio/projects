<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>4D Labyrinth</title>
</head>
  <body>
	<!--This draws the canvas on the webpage -->
  <div id="cookieConsentBanner" style="position: fixed; bottom: 0; width: 100%; background: #333; color: white; padding: 10px; text-align: center; display: none;">
    Cookies? 
    <input type="text" id="nicknameInput" placeholder="Enter your nickname" style="margin: 0 10px;">
    <button id="acceptCookies">Yes</button>
    <button id="declineCookies">No</button>
</div>
    <canvas id="mycanvas"></canvas> 
  </body>
 
  <!-- Include the processing.js library -->
  <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
  <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
  <script>
  var programCode = function(processingInstance) {
    with (processingInstance) {
      size(window.innerWidth-15, window.innerHeight-15); 
      frameRate(30);
        
      
      document.addEventListener("DOMContentLoaded", function() {
        const cookieBanner = document.getElementById("cookieConsentBanner");
        const acceptButton = document.getElementById("acceptCookies");
        const declineButton = document.getElementById("declineCookies");
        const nicknameInput = document.getElementById("nicknameInput");

        // Check if the user has already accepted cookies
        if (!localStorage.getItem("cookiesAccepted")) {
          cookieBanner.style.display = "block"; // Show the banner
        }

        acceptButton.onclick = function() {
          const nickname = nicknameInput.value.trim();
          if (nickname) {
            localStorage.setItem("nickname", nickname); // Save the nickname
          }
          localStorage.setItem("cookiesAccepted", "true");
          cookieBanner.style.display = "none"; // Hide the banner
          // Here you can add your cookie setting logic
          document.cookie = nickname+"*"+"0020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        };

        declineButton.onclick = function() {
          localStorage.setItem("cookiesAccepted", "false");
          cookieBanner.style.display = "none";
          document.cookie = "Anonymous"+"*"+"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
        };
      });


      translate(floor(floor(width/2)-(200)*height/900),0);
      // Paste code from Khan Academy here:

      scale(floor(height/900*40)/40);

      var currentDimension = 0;
      var oldDimension = 0;

      var keys = [];

      keyPressed = function(){
        keys[keyCode] = true;
        if(keyCode === 16){
          oldDimension = currentDimension;
        }
        if(keyCode === 78){
          playerNick = prompt("Enter your nickname:", playerNick || "Anonymous");   
          document.cookie.nick = playerNick;
        }
        if(keyCode === 80 && scene > 0){
          scene = 3-scene;
          document.cookie = playerNick+"*"+playerSkin.join("");
        }
        if(keyCode >= 49 && keyCode <= 57 && scene === 2){
          skinEditorColor = keyCode - 49;
        }
        if(keyCode === 48 && scene === 2){
          skinEditorColor = 9;
        }
      }

      keyReleased = function(){
        keys[keyCode] = false;
        if(keyCode === 16 && !keys[16] && blink){
          currentDimension = oldDimension;
          blink = false;
        }
      }
      
      mouseClicked = function(){
        playerSkin[skinSelectedPixel[1]*10+skinSelectedPixel[0]] = skinEditorColor;
      };

      var Level = function(config) {
        this.dimensions = config.dimensions;
        this.start = config.start;
        this.locked = config.locked || [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
      };
      

/*
1---111-111-1-1-111-1-1--1-111-1-1
1---1-1-1-1-111-1-1-1-11-1--1--111
1---111-11---1--11--1-1-11--1--1-1
111-1-1-111--1--1-1-1-1--1--1--1-1
*/


      var title = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [1,0,0,0,0,1,0,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0,1,0,1,1,1,0,1,0,1],
        [1,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,0,1,0,0,1,0,0,1,1,1],
        [1,0,0,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,0,0,1,0,1,0,1,1,0,0,1,0,0,1,0,1],
        [1,1,1,0,1,0,1,0,1,1,1,0,0,1,0,0,1,0,1,0,1,0,1,0,0,1,0,0,1,0,0,1,0,1]];
      var level1 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,2,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,1,0,0,1],
        [1,0,0,0,0,1,1,0,0,1],
        [1,0,0,0,0,1,1,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [3,14]
      });
      var level2 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,2,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [3,14]
      });
      var level3 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,2,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [2,15]
      });
      var level4 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,1,1,1],
        [1,0,0,0,0,2,0,1,1,1],
        [1,0,0,0,0,0,0,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [2,15]
      });
      var level5 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,2,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,4,4,4,4,4,4,4,4,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,1,1,1,1,1],
        [1,0,0,0,0,1,1,1,1,1],
        [1,0,0,0,0,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,3,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [2,15]
      });
      var level6 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,3,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,2,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [2,15],
        locked: [0,0,3,0]
      });
      var level7 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,4,0,0,0,0,1],
        [1,0,0,0,4,0,0,0,0,1],
        [1,0,0,0,4,0,0,0,0,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,2,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,3,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]]],
        start: [2,15],
        locked: [0,0,0,0]
      });
      var level8 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,2,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,7,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],],
        start: [2,15],
        locked: [0,0]
      });
      var level9 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,2,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,0,0,0,1,1,0,7,0,1],
        [1,0,0,0,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],],
        start: [2,15],
        locked: [0,0]
      });
      var level10 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,2,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,8,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,0,0,0,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1]],],
        start: [2,15],
        locked: [0,0]
      });
      var level11 = new Level({
        dimensions: [[
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,2,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],[
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,10,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,9,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]],],
        start: [2,15],
        locked: [0,0]
      });


      var scene = 0;
      var levels = [level1,level2,level3,level4,level5,level6,level7,level8,level9,level10,level11];
      var type = 0;
      var levelNumber = 0; 
      var currentLevel = levels[levelNumber];
      var finish = false;
      var blink = 0;
      var verticalSymmetryPressed = false;
      var horizontalSymmetryPressed = false;
      var portalDelay = false;
      var symmetryDimension = [];
      for(var i = 0; i < 18; i++){
        symmetryDimension.push([]);
        for(var j = 0; j < 10; j++){
          symmetryDimension[i].push([]);
        }
      }
      
      var playerX = currentLevel.start[0];
      var playerY = currentLevel.start[1];
      var playerNick = "Anonymous";
      var playerSkin = 0;

      var MappedX,MappedY;

      var opMode = false;

      replaceAt = function replaceChar(origString, replaceChar, index) {
        let firstPart = origString.substr(0, index);
        let lastPart = origString.substr(index + 1);
      
        let newString = firstPart + replaceChar + lastPart;
        return newString;
      }
      

      mapMouseX = function(value){
        return value - floor(floor(width/2)-(200)*height/900);
      };

      var moveCooldown = 3;

      var skinEditorColor = 0;
      var skinEditorColors = [
        color(255, 0, 0), // Red
        color(0, 255, 0), // Green
        color(0, 0, 255), // Blue
        color(255, 255, 0), // Yellow
        color(255, 165, 0), // Orange
        color(128, 0, 128), // Purple
        color(255, 255, 255), // White
        color(255, 192, 203), // Pink
        color(128, 128, 128), // Gray
        color(0, 0, 0) // Black
      ];
      var skinSelectedPixel = [0,0];

      var isSolid = function(coordinates){
        if(opMode && keys[88]){
          return(false);
        }
        switch(coordinates){
          case 0:
            return(false);
          break;
          case 1:
            return(true);
          break;
          case 2:
            return(false);
          break;
          case 3:
            return(false);
          break;
          case 4:
            return(true);
          break;
          case 5:
            return(false);
          break;
          case 6:
            return(true);
          break;
          case 7:
            return(false);
          break;
          case 8:
            return(false);
          break;
          case 9:
            return(false);
          break;
        }
      }

      var drawMap = function(level){
        noStroke();
        fill(255);
        for (var i = 0; i < level.length; i++) {
          for (var j = 0; j < level[i].length; j++) {
            if (level[i][j] === 1) {

              type = 0;

              if(level[max(i-1,0)][j] === 1){
                type += 1;
              }
              if(level[i][min(j+1,level[i].length)] === 1){
                type += 2;
              }
              if(level[min(i+1,level.length-1)][j] === 1){
                type += 4;
              }
              if(level[i][max(j-1,0)] === 1){
                type += 8;
              }


              pushMatrix();
              translate(j*40, i*40);
              noStroke();
              switch(type){
                case 0:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                break;
                case 1:
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  triangle(20,0,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  triangle(0,0,20,0,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(8, 0, 24, 24);
                break;
                case 2:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  triangle(40,20,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  triangle(40,40,40,20,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(16, 8, 24, 24);
                break;
                case 3:
                  fill(240);
                  triangle(40,40,0,40,40,0);
                  fill(220);
                  triangle(0,0,0,40,40,0);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(16, 0, 24, 32);
                  rect(8, 0, 24, 24);
                break;
                case 4:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  triangle(40,40,20,40,20,20);
                  fill(220);
                  triangle(0,0,0,40,20,20);
                  triangle(20,40,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(8, 16, 24, 24);
                break;
                case 5:
                  fill(160);
                  rect(20,0,20,40);
                  fill(220);
                  rect(0,0,20,40);
                  fill(200);
                  rect(8, 0, 24, 40);
                break;
                case 6:
                  fill(140);
                  triangle(0,0,40,0,40,40);
                  fill(220);
                  triangle(0,0,0,40,40,40);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(8, 16, 32, 24);
                  rect(16, 8, 24, 24);
                break;
                case 7:
                  fill(220);
                  rect(0,0,20,40);
                  fill(200);
                  rect(8, 0, 32, 40);
                break;
                case 8:
                  fill(140);
                  triangle(0,0,40,0,20,20);
                  triangle(0,0,0,20,20,20);
                  fill(160);
                  triangle(40,40,40,0,20,20);
                  fill(240);
                  triangle(40,40,0,40,20,20);
                  triangle(0,20,0,40,20,20);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(0, 8, 24, 24);
                break
                case 9:
                  fill(160);
                  triangle(40,40,40,0,0,0);
                  fill(240);
                  triangle(40,40,0,40,0,0);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(0, 0, 32, 24);
                  rect(0, 0, 24, 32);
                break
                ;
                case 10:
                  fill(140);
                  rect(0,0,40,20);
                  fill(240);
                  rect(0,20,40,20);
                  fill(200);
                  rect(0, 8, 40, 24);
                break;
                case 11:
                  fill(240);
                  rect(0,20,40,20);
                  fill(200);
                  rect(0, 0, 40, 32);
                break;
                case 12:
                  fill(140);
                  triangle(0,0,40,0,0,40);
                  fill(160);
                  triangle(40,40,40,0,0,40);
                  fill(200);
                  rect(8, 8, 24, 24, 5);
                  rect(0, 8, 24, 32);
                  rect(8, 16, 24, 24);
                break;
                case 13:
                  fill(160);
                  rect(20,0,20,40);
                  fill(200);
                  rect(0, 0, 32, 40);
                break;
                case 14:
                  fill(140);
                  rect(0,0,40,20);
                  fill(200);
                  rect(0, 8, 40, 32);
                break;
                case 15:
                  fill(200);
                  rect(0, 0, 40, 40);
                break; 
              }

              popMatrix();
            }else if (level[i][j] === 2){
              fill(230);
              rect(40*j,40*i,40,40);
              fill(50,230,50);
              rect(40*j,40*i,40,40,5);
              fill(50,150,50);
              pushMatrix();
                translate(40*j+25,40*i+3);
                rotate(PI/4);
                rect(0,0,15,27);
                fill(50,230,50);
                rect(-1,-1,9,21);
              popMatrix();
            }else if (level[i][j] === 0){
              fill(230);
              rect(40*j,40*i,40,40);
            }else if (level[i][j] === 3){
              fill(230);
              rect(40*j,40*i,40,40);
              fill(0,0,250);
              ellipse(40*j+20,40*i+20,30,30);
            }else if (level[i][j] === 4){
              fill(0,0,250);
              rect(40*j,40*i,40,40,5);
              fill(255);
              rect(40*j+8,40*i+17,24,15,5);
              arc(40*j+20,40*i+19,23,23,PI,PI*2);
              fill(0,0,250);
              arc(40*j+20,40*i+19,13,13,PI,PI*2);
            }else if (level[i][j] === 5){
              fill(230);
              rect(40*j,40*i,40,40);
              fill(250,0,250);
              ellipse(40*j+20,40*i+20,30,30);
            }else if (level[i][j] === 6){
              fill(250,0,250);
              rect(40*j,40*i,40,40,5);
              fill(255);
              rect(40*j+8,40*i+17,24,15,5);
              arc(40*j+20,40*i+19,23,23,PI,PI*2);
              fill(250,0,250);
              arc(40*j+20,40*i+19,13,13,PI,PI*2);
            }else if (level[i][j] === 7){
              fill(230);
              rect(40*j,40*i,40,40);
              fill(50,230,50);
              rect(40*j,40*i,40,40,5);
              fill(50,150,50);
              pushMatrix();
                translate(40*j+20,40*i+35);
                rotate(PI/4*5);
                rect(0,0,4,12);
                rect(0,0,12,4);
              popMatrix();
              pushMatrix();
                translate(40*j+20,40*i+5);
                rotate(PI/4);
                rect(0,0,4,12);
                rect(0,0,12,4);
              popMatrix();
              rect(j*40+18,i*40+10,4,22);
            }else if (level[i][j] === 8){
              fill(230);
              rect(40*j,40*i,40,40);
              fill(50,230,50);
              rect(40*j,40*i,40,40,5);
              fill(50,150,50);
              pushMatrix();
                translate(40*j+35,40*i+20);
                rotate(PI/4*3);
                rect(0,0,4,12);
                rect(0,0,12,4);
              popMatrix();
              pushMatrix();
                translate(40*j+5,40*i+20);
                rotate(PI/4*7);
                rect(0,0,4,12);
                rect(0,0,12,4);
              popMatrix();
              rect(j*40+10,i*40+18,22,4);
            }else if (level[i][j] === 9){
              fill(230);
              rect(40*j,40*i,40,40);
              fill(255,165,0);
              rect(40*j,40*i,40,40,5);
              fill(225,135,0);
              ellipse(40*j+20,40*i+20,30,30);
              fill(255,165,0);
              ellipse(40*j+20,40*i+20,20,20);
            }else if (level[i][j] === 10){
              fill(230);
              rect(40*j,40*i,40,40);
              fill(30,144,255);
              rect(40*j,40*i,40,40,5);
              fill(10,114,225);
              ellipse(40*j+20,40*i+20,30,30);
              fill(30,144,255);
              ellipse(40*j+20,40*i+20,20,20);
            }
          }
        }
      };



      draw = function() {
        background(250);

        textFont(createFont("sans-serif"));

        //map mouseX

        MappedX = mapMouseX(mouseX);
        MappedY = mouseY+10;

        switch(scene){
        case 0:
          background(230);
          pushMatrix();
          translate(-80,100);
          scale(560/(34*40));
          drawMap(title);
          popMatrix();
          fill(0);
          textSize(50);
          text("Press Space\n     to start", 60, 500);
          if(keys[32]){
            scene = 1;
          }
        break;
        case 1:
        //println("Drawing...");
        //println(document.cookie.split("*")[0])


        

        //update the nickname and skin

        playerNick = document.cookie.split("*")[0];

        playerSkin = document.cookie.split("*")[1];

        playerSkin[2] = 2;

        println("Player Skin: " + playerSkin);

        //move the player
        if(moveCooldown < 0 && !finish && !keys[16]){ 
          if((keys[UP] || keys[87]) && !isSolid(currentLevel.dimensions[currentDimension][playerY-1][playerX])){
            playerY -= 1;
            moveCooldown = 3;
          }
          if((keys[DOWN] || keys[83]) && !isSolid(currentLevel.dimensions[currentDimension][playerY+1][playerX])){
            playerY += 1;
            moveCooldown = 3;
          }
          if((keys[LEFT] || keys[65]) && !isSolid(currentLevel.dimensions[currentDimension][playerY][playerX-1])){
            playerX -= 1;
            moveCooldown = 3;
          }
          if((keys[RIGHT] || keys[68]) && !isSolid(currentLevel.dimensions[currentDimension][playerY][playerX+1])){
            playerX += 1;
            moveCooldown = 3;
          }
        }
        moveCooldown -= 1;

        //press the buttons

        if(currentLevel.dimensions[currentDimension][playerY][playerX] === 3 && !keys[16] || opMode && keys[66]){
          currentLevel.dimensions[currentDimension][playerY][playerX] = 0;
          for(var i = 0; i < currentLevel.dimensions.length; i++){
            for(var j = 0; j < currentLevel.dimensions[i].length; j++){
              for(var k = 0; k < currentLevel.dimensions[i][j].length; k++){
                if(currentLevel.dimensions[i][j][k] === 4){
                  currentLevel.dimensions[i][j][k] = 0;
                }
              }  
            }  
          }
          for(var i = 0; i < currentLevel.dimensions.length; i++){
            if(currentLevel.locked[i] === 3){
              currentLevel.locked[i] = 0;
            }
          }
        }
        if(currentLevel.dimensions[currentDimension][playerY][playerX] === 5 && !keys[16] || opMode && keys[80]){
          currentLevel.dimensions[currentDimension][playerY][playerX] = 0;
          for(var i = 0; i < currentLevel.dimensions.length; i++){
            for(var j = 0; j < currentLevel.dimensions[i].length; j++){
              for(var k = 0; k < currentLevel.dimensions[i][j].length; k++){
                if(currentLevel.dimensions[i][j][k] === 6){
                  currentLevel.dimensions[i][j][k] = 0;
                }
              }  
            }  
          }
          for(var i = 0; i < currentLevel.dimensions.length; i++){
            if(currentLevel.locked[i] === 5){
              currentLevel.locked[i] = 0;
            }
          }
        }
        
        //press the symmetry buttons

        if(currentLevel.dimensions[currentDimension][playerY][playerX] === 7){
          if(!verticalSymmetryPressed && !keys[16]){
            verticalSymmetryPressed = true;
            symmetryDimension = [
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0]];
            for(var i = 0; i < 18; i++){
              symmetryDimension[i] = currentLevel.dimensions[currentDimension][17-i];
            }
            currentLevel.dimensions[currentDimension] = symmetryDimension;
            playerY = 17-playerY;
          }
        }else{
          verticalSymmetryPressed = false;
        }
        if(currentLevel.dimensions[currentDimension][playerY][playerX] === 8){
          if(!horizontalSymmetryPressed && !keys[16]){
            horizontalSymmetryPressed = true;
            symmetryDimension = [
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0]];
            for(var i = 0; i < 18; i++){
              for(var j = 0; j < 10; j++){
                symmetryDimension[i][j] = currentLevel.dimensions[currentDimension][i][9-j];
              }
            }
            currentLevel.dimensions[currentDimension] = symmetryDimension;
            playerX = 9-playerX;
          }
        }else{
          horizontalSymmetryPressed = false;
        }

        //teleport through portals

        if(currentLevel.dimensions[currentDimension][playerY][playerX] === 9){
          for(var i = 0; i < currentLevel.dimensions.length; i++){
            for(var j = 0; j < currentLevel.dimensions[i].length; j++){
              for(var k = 0; k < currentLevel.dimensions[i][j].length; k++){
                if(currentLevel.dimensions[i][j][k] === 10 && !(i === currentDimension && j === playerY && k === playerX) && !portalDelay){
                  playerX = k;
                  playerY = j;
                  currentDimension = i;
                  portalDelay = true;
                }
              }  
            }  
          }
        }

        if(currentLevel.dimensions[currentDimension][playerY][playerX] === 10){
          for(var i = 0; i < currentLevel.dimensions.length; i++){
            for(var j = 0; j < currentLevel.dimensions[i].length; j++){
              for(var k = 0; k < currentLevel.dimensions[i][j].length; k++){
                if(currentLevel.dimensions[i][j][k] === 9 && !(i === currentDimension && j === playerY && k === playerX) && !portalDelay){
                  playerX = k;
                  playerY = j;
                  currentDimension = i;
                  portalDelay = true;
                }
              }  
            }  
          }
        }

        if(currentLevel.dimensions[currentDimension][playerY][playerX] !== 9 && currentLevel.dimensions[currentDimension][playerY][playerX] !== 10){          
          portalDelay = false;
        }

        //draw the level

        drawMap(currentLevel.dimensions[currentDimension]);

        //draw the nickname and level number

        pushMatrix();

        translate(-floor(floor(width/2)-(200)*height/900),0);
        fill(0);
        textSize(20);
        text(playerNick, 5, 25);
        text("level: "+(levelNumber+1), 5, 55);

        popMatrix();

        
        //draw the player

        noStroke();
        /*fill(255,0,0);
        rect(playerX*40,playerY*40,40,40,5);*/

        for(var i = 0; i < 10; i++){
          for(var j = 0; j < 10; j++){
            fill(skinEditorColors[playerSkin.substr(i*10+j,1)]);
            rect(playerX*40+j*4,playerY*40+i*4,4,4);
          }
        }
        fill(230);
        rect(playerX*40,playerY*40,4,4);
        rect(playerX*40,playerY*40+36,4,4);
        rect(playerX*40+36,playerY*40,4,4);
        rect(playerX*40+36,playerY*40+36,4,4);
        fill(skinEditorColors[playerSkin.substr(0,1)]);
        arc(playerX*40+4,playerY*40+4,8,8,PI,PI*1.5);
        fill(skinEditorColors[playerSkin.substr(9,1)]);
        arc(playerX*40+36,playerY*40+4,8,8,PI*1.5,PI*2);
        fill(skinEditorColors[playerSkin.substr(90,1)]);
        arc(playerX*40+4,playerY*40+36,8,8,PI*0.5,PI);
        fill(skinEditorColors[playerSkin.substr(99,1)]);
        arc(playerX*40+36,playerY*40+36,8,8,0,PI*0.5);


        //draw the dimension list

        fill(220);
        rect(-80,730,560,164);


        for(var i = 0; i < currentLevel.dimensions.length; i++){
          pushMatrix();
          translate(-30, 740);
          translate(floor(460/(currentLevel.dimensions.length+0.5)*(i+0.75)),0);

          pushMatrix();
          scale(0.2);
          translate(-200, 0);
          if(i === currentDimension){
            fill(255,0,0);
            rect(-20,-20,20,760);
            rect(-20,-20,440,20);
            rect(400,-20,20,760);
            rect(-20,720,440,20);
          }
          drawMap(currentLevel.dimensions[i]);
          if(currentLevel.locked[i] === 3){
            fill(0,0,255);
            rect(-20,-20,20,760);
            rect(-20,-20,440,20);
            rect(400,-20,20,760);
            rect(-20,720,440,20);
            fill(0,0,255,100);
            rect(-20,-20,440,760);
            fill(255);
            rect(100,280,200,150,30);
            arc(200,290,170,170,PI,PI*2);
            fill(100,100,250);
            arc(200,290,130,130,PI,PI*2);
          }
          noStroke();
          fill(255,0,0)
          rect(playerX*40,playerY*40,40,40,5);
          popMatrix();

          popMatrix();
        }

        //check for finish

        if(currentLevel.dimensions[currentDimension][playerY][playerX] === 2){
          finish = true;
        }
        if(finish){
          fill(0,200,0,100);
          rect(-width, 250, 4*width, 250);
          fill(0);
          textSize(50);
          text("Level Complete!", 50, 350);
          textSize(20);
          text("Press Space to continue", 100, 400);
          if(keys[32]){
            finish = false;
            levelNumber += 1;
            currentLevel = levels[levelNumber];
            playerX = currentLevel.start[0];
            playerY = currentLevel.start[1];
            currentDimension = 0;
          }
        }

        //dimension switch

        if(keys[16]){
          background(220);
          for(var i = 0; i < currentLevel.dimensions.length; i++){
            pushMatrix();
            translate(-90+(i%3)*(200), 20+320*floor(i/3));
            scale(0.4);
            if(i === currentDimension){
              fill(255,0,0);
              rect(-20,-20,20,760);
              rect(-20,-20,440,20);
              rect(400,-20,20,760);
              rect(-20,720,440,20);
            }
            drawMap(currentLevel.dimensions[i]);
            if(currentLevel.locked[i] === 3){
              fill(0,0,255);
              rect(-20,-20,20,760);
              rect(-20,-20,440,20);
              rect(400,-20,20,760);
              rect(-20,720,440,20);
              fill(0,0,255,100);
              rect(-20,-20,440,760);
              fill(255);
              rect(100,280,200,150,30);
              arc(200,290,170,170,PI,PI*2);
              fill(100,100,250);
              arc(200,290,130,130,PI,PI*2);
            }else if(currentLevel.dimensions[i][playerY][playerX] === 1){
              fill(255,0,0,100);
              rect(-20,-20,440,760);
            }
            noStroke();
            fill(255,0,0)
            rect(playerX*40,playerY*40,40,40,5);
            popMatrix();

            popMatrix();
          }
          if((keys[RIGHT] || keys[68])){
            currentDimension += 1;
            if(currentDimension >= currentLevel.dimensions.length){
              currentDimension = currentLevel.dimensions.length-1;
            }
            if(currentLevel.dimensions[currentDimension][playerY][playerX] === 1 || currentLevel.locked[currentDimension] !== 0){
              blink = true;
            }else{
              blink = false;
            }
            keys[RIGHT] = false;
            keys[68] = false;
          }
          if((keys[LEFT] || keys[65])){
            currentDimension -= 1;
            if(currentDimension < 0){
              currentDimension = 0;
            }
            keys[LEFT] = false;
            keys[65] = false;
            if(currentLevel.dimensions[currentDimension][playerY][playerX] === 1 || currentLevel.locked[currentDimension] !== 0){  
              blink = true;
            }else{
              blink = false;
            }
          }
          if(currentLevel.dimensions.length > 3){
            if((keys[DOWN] || keys[83])){
              currentDimension += 3;
              if(currentDimension >= currentLevel.dimensions.length){
                currentDimension = currentLevel.dimensions.length-1;
              }
              if(currentLevel.dimensions[currentDimension][playerY][playerX] === 1 || currentLevel.locked[currentDimension] !== 0){
              blink = true;
            }else{
                blink = false;
              }
              keys[DOWN] = false;
              keys[83] = false;
            }
            if((keys[UP] || keys[104]) && currentDimension > 2){
              currentDimension -= 3;
              if(currentDimension < 0){
                currentDimension = 0;
              }
              if(currentLevel.dimensions[currentDimension][playerY][playerX] === 1 || currentLevel.locked[currentDimension] !== 0){
                blink = true;
              }else{
                blink = false;
              }
              keys[UP] = false;
              keys[87] = false;
            }
          }
          /*if(blink){
            fill(220,0,0,100);
            rect(-width,-height,2*width,2*height);
          }*/
        
        }

        //tutorial text

        if(levelNumber === 0){
          fill(0);
          textSize(25);
          text("Use the arrow\nkeys or WASD\nto move", 180, 500);
        }
        if(levelNumber === 1){
          fill(0);
          textSize(25);
          text("Hold shift to\nswitch\ndimensions", 210, 500);
        }

        //op mode

        if(keys[81]){
          opMode = true;
        }
        if(opMode){
          textFont(createFont("monospace"));
          fill(0,255,0);
          text("B to press blue buttons",420,200);
          text("P to press pink buttons",420,230);
          text("Hold X to phase through walls",420,260);
        }
        if(keys[50] && keys[52] && keys[81]){
          opMode = false;
        }

        break;
        case 2:
          background(230);
          stroke(0);

          //find the pixel

          skinSelectedPixel = [constrain(floor((MappedX)/40),0,9), constrain(floor((MappedY-280)/40),0,9)];

          //println(constrain(floor((MappedX)/40),0,9)+" "+ constrain(floor((MappedY-280)/40),0,9));

          for(var i = 0; i < 10; i++){
            for(var j = 0; j < 10; j++){
              strokeWeight(1);
              stroke(0);
              fill(skinEditorColors[playerSkin[i*10+j]]);
              if(j === skinSelectedPixel[0] && i === skinSelectedPixel[1]){
                strokeWeight(3);
              }
              rect(j*40,i*40+280,40,40);
            }
          }
          for(var i = 0; i < 10; i++){
            strokeWeight(1);
            stroke(0);
            fill(skinEditorColors[i]);
            if(i === skinEditorColor){
              strokeWeight(3);
            }
            rect(0+i*40,200,40,40);
            fill(0);
            textSize(30);
            text(i+1-10*max(0,i-8), 10+i*40, 190);
          }
          text("Hold space to draw pixels",0,760);
          text("Press numbers to switch colors",0,800);
          if(keys[32]){
            playerSkin = replaceAt(playerSkin,skinEditorColor, skinSelectedPixel[0]+skinSelectedPixel[1]*10);
            document.cookie = playerNick+"*"+playerSkin;
          }
          fill(255,0,0);
          ellipse(MappedX,MappedY, 10, 10);
        break;

        };

      }
    }};

  // Get the canvas that ProcessingJS will use
  var canvas = document.getElementById("mycanvas"); 
  // Pass the function to ProcessingJS constructor
  var processingInstance = new Processing(canvas, programCode); 
  </script>
</html>
